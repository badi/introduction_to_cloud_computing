#! /usr/bin/env python

import glob
import sh
from sh import sh
import sys
import os
from pprint import pprint
from cloudmesh_common.util import banner

def find_files(root, ending):
    all_files = []
    for root, dirs, files in os.walk(root):
        for file in files:
            if file.endswith(ending):
                all_files.append(os.path.join(root, file))
    return all_files



def execute_all(command, files): 
  for filename in files:
      data = {
          'command': command,
          'filename': filename,
          'dirname': os.path.dirname(filename),
          'basename': os.path.basename(filename)
          }    
    
      _command  = "cd {dirname} ; {command} {basename} > /dev/null 2>&1".format(**data)
      print _command
      # os.system(_command)

root = "docs/source/notebook"

banner ("rm rst files")
files = find_files(root, ".rst")
execute_all("rm", files)

banner ("convert ipython notebooks")
files = find_files(root, ".ipynb")
execute_all("ipython nbconvert --to=rst", files)
      

    
